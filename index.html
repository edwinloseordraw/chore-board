<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chore Board</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#111111" />
  <link rel="manifest" href="manifest.webmanifest" />
  
  <style>
        :root{
      /* Theme variables (default theme: Neon Glass / Dark) */
      --bg: radial-gradient(1200px 800px at 20% 10%, rgba(0,255,240,0.10), transparent 55%),
            radial-gradient(900px 700px at 80% 25%, rgba(255,0,200,0.10), transparent 55%),
            linear-gradient(180deg, #0b0f12 0%, #07090b 100%);
      --headerBg: rgba(12,14,18,0.88);

      --panel: rgba(255,255,255,0.06);
      --panel2: rgba(255,255,255,0.08);
      --panel3: rgba(0,0,0,0.28);

      --border: rgba(255,255,255,0.10);
      --border2: rgba(255,255,255,0.12);

      --text: #f5f5f5;
      --muted: rgba(245,245,245,0.75);
      --muted2: rgba(245,245,245,0.6);

      --btn: rgba(255,255,255,0.10);
      --btnHover: rgba(255,255,255,0.14);
      --btnActive: #22f0b6;
      --danger: #c62828;

      --inputBg: rgba(0,0,0,0.30);
      --inputBorder: rgba(255,255,255,0.14);

      --ringTrack: rgba(255,255,255,0.22);

      --shadow: 0 14px 28px rgba(0,0,0,0.45);
      --glassBlur: 14px;

      /* Neumorphism shadows (color-agnostic; themes still own colors) */
      --neuOutShadow: 8px 8px 18px rgba(0,0,0,0.38), -6px -6px 14px rgba(255,255,255,0.06);
      --neuOutShadowSoft: 6px 6px 14px rgba(0,0,0,0.34), -5px -5px 12px rgba(255,255,255,0.05);
      --neuInShadow: inset 8px 8px 18px rgba(0,0,0,0.42), inset -6px -6px 14px rgba(255,255,255,0.06);
      --neuInShadowSoft: inset 6px 6px 14px rgba(0,0,0,0.36), inset -5px -5px 12px rgba(255,255,255,0.05);
          
      --radius: 12px;
    }

      /* Neumorphism helpers */
      .neuOut{ box-shadow: var(--neuOutShadow); }
      .neuOutSoft{ box-shadow: var(--neuOutShadowSoft); }
      .pressed{ box-shadow: var(--neuInShadow) !important; }
      .pressedSoft{ box-shadow: var(--neuInShadowSoft) !important; }
    
    .assignSelect{
      width: 130px;
      padding: 6px 8px;
      border-radius: 10px;
      border: 1px solid var(--inputBorder);
      background: var(--inputBg);
      color: var(--text);
      font-size: 13px;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    header{
      display:flex;
      gap:8px;
      padding:10px;
      background:var(--headerBg);
      flex-wrap:wrap;
      align-items:center;
      position:sticky;
      top:0;
      z-index:5;
      justify-content:flex-start;
      backdrop-filter: blur(var(--glassBlur));
      -webkit-backdrop-filter: blur(var(--glassBlur));
      box-shadow: var(--neuOutShadowSoft);
    }

            header button.active{
      background:var(--btnActive);
      color:#000;
      font-weight:800;
      border-color: rgba(0,0,0,0.25);
    }

    header button.active{
      background:var(--btnActive);
      color:#000;
      font-weight:700;
    }

        header select{
      background:var(--btn);
      color:var(--text);
      border:1px solid var(--border2);
      padding:8px 12px;
      border-radius:10px;
      font-size:14px;
      cursor:pointer;
      white-space:nowrap;
      appearance:none;
      -webkit-appearance:none;
      line-height:1.2;
    }
    header select:hover{ background:var(--btnHover); }

    /* Left side navigation (hamburger opens a panel on the left) */
    .menuWrap{
      position:relative;
      display:flex;
      align-items:center;
    }

    .hamburgerBtn{
      background:var(--btn);
      color:var(--text);
      border:1px solid var(--border2);
      padding:8px 12px;
      border-radius:12px;
      font-size:18px;
      cursor:pointer;
      line-height:1;
      white-space:nowrap;
      height:40px;
      box-shadow: var(--neuOutShadowSoft);
    }
    .hamburgerBtn:hover{ background:var(--btnHover); }
    .hamburgerBtn:active{ box-shadow: var(--neuInShadowSoft); }

    .sideOverlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.45);
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(2px);
      display:none;
      z-index:60;
    }
    .sideOverlay.open{ display:block; }

    .sidePanel{
      position:fixed;
      top:0;
      left:0;
      height:100vh;
      width:300px;
      max-width:85vw;
      background:var(--headerBg);
      border-right:1px solid var(--border2);
      box-shadow: 18px 0 36px rgba(0,0,0,0.45);
      transform: translateX(-105%);
      transition: transform 180ms ease;
      z-index:70;
      display:flex;
      flex-direction:column;
      padding:10px;
      gap:10px;
    }
    .sidePanel.open{ transform: translateX(0); }

    .sideHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:8px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.04);
      box-shadow: var(--neuOutShadowSoft);
    }
    .sideTitle{
      font-weight:900;
      letter-spacing:0.2px;
      opacity:0.95;
      font-size:14px;
    }
    .sideClose{
      background:transparent;
      border:1px solid rgba(255,255,255,0.14);
      color:var(--text);
      border-radius:10px;
      padding:8px 10px;
      cursor:pointer;
      box-shadow: var(--neuOutShadowSoft);
    }
    .sideClose:hover{ background: rgba(255,255,255,0.06); }
    .sideClose:active{ box-shadow: var(--neuInShadowSoft); }

    .sideNav{
      display:flex;
      flex-direction:column;
      gap:8px;
      overflow:auto;
      padding-right:2px;
    }

    .sideBtn{
      width:100%;
      text-align:left;
      background:var(--btn);
      border:1px solid var(--border2);
      color:var(--text);
      padding:12px 12px;
      border-radius:12px;
      font-size:14px;
      cursor:pointer;
      box-shadow: var(--neuOutShadowSoft);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .sideBtn:hover{ background:var(--btnHover); }
    .sideBtn:active{ box-shadow: var(--neuInShadowSoft); }
    .sideBtn.active{ box-shadow: var(--neuInShadowSoft); }

    .sideChevron{
      opacity:0.75;
      font-weight:900;
      transform: rotate(0deg);
      transition: transform 160ms ease;
    }
    .sideBtn[aria-expanded="true"] .sideChevron{ transform: rotate(90deg); }

    .sideSub{
      display:none;
      padding-left:10px;
      margin-top:4px;
      margin-bottom:6px;
      gap:6px;
      flex-direction:column;
    }
    .sideSub.open{ display:flex; }

    .sideSub .sideBtn{
      padding:10px 12px;
      border-radius:12px;
      font-size:13px;
    }

    /* Notes overlay (for quick viewing today's notes without leaving the day page) */
    .notesOverlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.45);
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(2px);
      display:none;
      z-index:80;
    }
    .notesOverlay.open{ display:block; }

    .notesPanel{
      position:fixed;
      top:14px;
      left:50%;
      transform: translateX(-50%) translateY(-110%);
      width:min(720px, 92vw);
      max-height:86vh;
      background:var(--headerBg);
      border:1px solid var(--border2);
      border-radius:14px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.45);
      z-index:90;
      display:flex;
      flex-direction:column;
      gap:10px;
      padding:12px;
      transition: transform 180ms ease;
    }
    .notesPanel.open{ transform: translateX(-50%) translateY(0); }

    .notesHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:8px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.04);
      box-shadow: var(--neuOutShadowSoft);
    }
    .notesTitle{
      font-weight:900;
      letter-spacing:0.2px;
      opacity:0.95;
      font-size:14px;
    }
    .notesClose{
      background:transparent;
      border:1px solid rgba(255,255,255,0.14);
      color:var(--text);
      border-radius:10px;
      padding:8px 10px;
      cursor:pointer;
      box-shadow: var(--neuOutShadowSoft);
    }
    .notesClose:hover{ background: rgba(255,255,255,0.06); }
    .notesClose:active{ box-shadow: var(--neuInShadowSoft); }

    .notesBody{
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:0;
    }

    .notesBody textarea{
      min-height:220px;
      resize:vertical;
    }

    /* Uniform top-nav controls (Weekly Reset, misc header buttons) */
    .navBtn{
      background:var(--btn);
      color:var(--text);
      border:1px solid var(--border2);
      padding:10px 14px;
      border-radius:12px;
      font-size:14px;
      cursor:pointer;
      white-space:nowrap;
      height:40px;
      box-shadow: var(--neuOutShadowSoft);
    }
    
    .navBtn:hover{ background:var(--btnHover); }
    .navBtn:active{ box-shadow: var(--neuInShadowSoft); }

    .navBtn.danger{
      background:var(--danger);
      border-color: rgba(0,0,0,0.25);
      box-shadow: var(--neuOutShadowSoft);
    }

    /* Active nav should look pressed in */
    header button.active{
      box-shadow: var(--neuInShadowSoft);
    }
    
    header .spacer{ flex:1; }

    header .danger{ background:var(--danger); }

    main{
      flex:1;
      padding:10px;
      overflow: visible;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:0;
    }
.maintForm{
  display:grid;
  grid-template-columns: 2fr 1fr 1fr auto;
  gap:12px;
  align-items:end;
}
.maintForm .field label{
  display:block;
  font-size:12px;
  opacity:.8;
  margin-bottom:6px;
}
.maintForm input, .maintForm select{
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid var(--inputBorder);
  background:var(--inputBg);
  color:var(--text);
  height:40px;
  box-shadow: var(--neuOutShadowSoft);
}
.maintForm .actions button{
  width:100%;
}

.maintList{
  display:flex;
  flex-direction:column;
  gap:10px;
}
.maintRow{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.18);
}
.maintTask{
  font-weight:700;
}
.maintSub{
  margin-top:4px;
  font-size:12px;
  opacity:.8;
}

@media (max-width: 980px){
  .maintForm{ grid-template-columns: 1fr; }
}

    /* ---------- Common panels ---------- */
    .panel{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:10px;
      box-shadow: var(--neuOutShadow);
    }

    .panel h2, .panel h3{
      margin:0 0 8px 0;
      font-size:14px;
      letter-spacing:0.2px;
      opacity:0.95;
    }

    .hint{
      font-size:12px;
      color:var(--muted2);
      margin-top:-4px;
      margin-bottom:8px;
      line-height:1.25;
    }

    /* ---------- Dashboard ---------- */
    .dashGrid{
      display:grid;
      grid-template-columns: 1.2fr 1fr;
      gap:10px;
      min-height:0;
    }
    .dashHeaderRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:6px;
    }
    .dashHeaderRow h2{
      margin:0;
    }

    .rings{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:10px;
      align-items:stretch;
    }

    .ringCard{
      background:var(--panel2);
      border:1px solid var(--border2);
      border-radius:var(--radius);
      padding:12px;
      width:100%;
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:center;
      justify-content:flex-start;
      text-align:center;
      box-shadow: var(--neuOutShadow);
    }

    .ringMeta{
      display:flex;
      flex-direction:column;
      gap:4px;
      align-items:center;
      justify-content:center;
    }
    .ringFilter{
      width:100%;
      max-width: 180px;
      background:var(--inputBg);
      color:var(--text);
      border:1px solid var(--inputBorder);
      border-radius:10px;
      padding:8px 10px;
      font-size:13px;
    }

    .ringSvgWrap{
      width:128px;
      height:128px;
      position:relative;
      flex:0 0 auto;
    }

    .ringSvgWrap .pct{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:22px;
      font-weight:900;
      letter-spacing:0.2px;
    }

    svg{ display:block; }

    /* a slightly "chalky" look without getting fancy */
    .chalkTrack{ opacity:0.25; }
    .chalkStroke{
      filter: drop-shadow(0 0 0.6px rgba(255,255,255,0.2));
    }

    .dashNav{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:10px;
    }

    .dashNav button{
      padding:10px 12px;
      border-radius:10px;
    }

    .notesBox{
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:0;
    }

    .notesControls{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }

        .notesControls input{
      background:var(--inputBg);
      border:1px solid var(--inputBorder);
      color:var(--text);
      border-radius:10px;
      padding:8px 10px;
      font-size:14px;
      width:180px;
    }

    .notesControls .small{
      font-size:12px;
      color:var(--muted2);
    }

        textarea{
      width:100%;
      min-height:180px;
      background:var(--inputBg);
      color:var(--text);
      border:1px solid var(--inputBorder);
      border-radius:12px;
      padding:10px;
      resize:vertical;
      font-size:14px;
      line-height:1.25;
    }

    .lockedOverlay{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:space-between;
      background:rgba(0,0,0,0.35);
      border:1px dashed rgba(255,255,255,0.25);
      border-radius:10px;
      padding:10px;
      color:var(--muted);
      font-size:13px;
    }

    /* ---------- Day view ---------- */
    .columns{
      display:grid;
      grid-template-columns:repeat(4, minmax(260px, 1fr));
      gap:10px;
      align-items:stretch;

      /* No independent scrolling — page scrolls as one */
      flex:0;
      overflow:visible;
    }

    .column{
      background:var(--panel2);
      border:1px solid var(--border2);
      border-radius:var(--radius);
      padding:10px;
      display:flex;
      flex-direction:column;
      box-shadow: var(--neuOutShadow);

      /* Let content define height. Grid can still stretch columns evenly without forcing extra blank space. */
      min-height: 0;
    }

    /* Day header (day name + date) */
    .dayHeaderBar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 12px;
    }
    .dayHeaderBar .dayTitle{
      margin:0;
      font-size:18px;
      font-weight:900;
      text-transform:capitalize;
    }
    .dayHeaderBar .dayDate{
      font-size:13px;
      font-weight:800;
      color:var(--muted2);
      white-space:nowrap;
    }

    .column h2{
      margin:0 0 8px 0;
      text-align:center;
      font-size:16px;
      font-weight:800;
    }

    .chore{
      margin-bottom:3px;
      font-size:14px;
    }

    /* Phase 8.5: make the entire chore row (including text) a tap target */
    .choreLabel{
      display:flex;
      align-items:center;
      gap:7px;
      padding:7px 10px;
      border-radius:10px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: rgba(255,255,255,0.08);
      box-shadow: var(--neuOutShadowSoft);
    }
    .choreLabel:active{
      background: rgba(255,255,255,0.06);
    }
    .choreLabel span{
      flex:1;
      line-height:1.1;
    }
    .choreLabel input[type="checkbox"]{
      width:18px;
      height:18px;
      flex:0 0 auto;
    }

    /* Weekly chores panel (Phase 3), moved BELOW columns per your request */
    .weeklyGrid{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:8px 10px;
    }

    .weeklyItem{
      display:grid;
      grid-template-columns:18px 1fr 120px;
      align-items:center;
      gap:8px;
      background:var(--panel3);
      border:1px solid var(--border2);
      border-radius:10px;
      padding:8px;
      min-height:44px;
      box-shadow: var(--neuOutShadowSoft);
    }

    .weeklyItem .label{
      font-size:13px;
      opacity:0.95;
      line-height:1.15;
      word-break:break-word;
    }

        .weeklyItem select{
      background:var(--inputBg);
      color:var(--text);
      border:1px solid var(--inputBorder);
      border-radius:10px;
      padding:6px 8px;
      font-size:13px;
      width:120px;
    }

    /* Yesterday summary */
    .yesterdayGrid{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:10px;
    }

    .yCard{
      background:var(--panel3);
      border:1px solid var(--border2);
      border-radius:10px;
      padding:8px;
      min-height:48px;
    }

    .yTitle{
      font-weight:800;
      font-size:13px;
      text-align:center;
      margin-bottom:6px;
      opacity:0.95;
    }

    .yLine{
      font-size:12.5px;
      opacity:0.9;
      margin:4px 0;
      line-height:1.2;
      word-break:break-word;
    }

    .notesDay textarea{
      min-height:110px;
    }

        /* ---------- Theme controls (Admin) ---------- */
    .themeGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    .themeRow{
      background:var(--panel2);
      border:1px solid var(--border2);
      border-radius:12px;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .themeRow label{
      font-size:12px;
      color:var(--muted2);
    }
    .themeRow select, .themeRow button{
      background:var(--btn);
      color:var(--text);
      border:1px solid var(--border2);
      padding:10px 12px;
      border-radius:12px;
      font-size:14px;
      cursor:pointer;
    }
    .themeRow select:hover, .themeRow button:hover{ background:var(--btnHover); }
    .modeBtns{ display:flex; gap:8px; flex-wrap:wrap; }
    .modeBtns button.active{
      background:var(--btnActive);
      color:#000;
      font-weight:900;
      border-color: rgba(0,0,0,0.25);
    }
    
    /* ---------- Admin (member colors) ---------- */
    .adminGrid{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:10px;
    }
    .adminRow{
      background:var(--panel2);
      border:1px solid var(--border2);
      border-radius:12px;
      padding:12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      min-height:56px;
    }
    .adminName{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:800;
      font-size:14px;
    }
    .colorInput{
      width:54px;
      height:36px;
      border:none;
      background:transparent;
      padding:0;
      cursor:pointer;
    }

    /* ---------- Admin (pre-write day notes) ---------- */
    .adminNotesGrid{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:10px;
      margin-top:10px;
    }
    .adminNoteCard{
      background:var(--panel2);
      border:1px solid var(--border2);
      border-radius:12px;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:120px;
    }
    .adminNoteCard .adminNoteTitle{
      font-weight:900;
      font-size:13px;
      opacity:0.95;
    }
    .adminNoteCard textarea{
      min-height:110px;
    }

    /* ---------- Simple list pages (biweekly/monthly/maintenance scaffolding) ---------- */
    .listGrid{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:10px;
    }
    .listItem{
      background:var(--panel2);
      border:1px solid var(--border2);
      border-radius:10px;
      padding:10px;
      display:flex;
      align-items:center;
      gap:10px;
      min-height:48px;
      box-shadow: var(--neuOutShadowSoft);
    }
    .listItem .name{
      flex:1;
      font-size:14px;
      opacity:0.95;
    }
    .toolbar{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-bottom:8px;
    }
    .toolbar .left{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center;
    }
    .toolbar .right{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center;
    }
    .toolbar button{
      background:var(--btn);
      color:#fff;
      border:none;
      border-radius:10px;
      padding:10px 12px;
      cursor:pointer;
    }
    .toolbar button.danger{ background:var(--danger); }

    /* ghost buttons (used in Maintenance rows) */
    button.ghost{
      background: transparent;
      border: 1px solid rgba(255,255,255,0.14);
      color: var(--text);
      border-radius: 10px;
      padding: 8px 10px;
      cursor: pointer;
    }
    button.ghost:hover{
      background: rgba(255,255,255,0.06);
    }

    /* ---------- Groceries (persistent panel) ---------- */
    .groceryBtn{
      background:var(--btn);
      color:var(--text);
      border:1px solid var(--border2);
      border-radius:12px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:900;
      box-shadow: var(--neuOutShadowSoft);
      line-height:1;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width:44px;
      min-height:44px;
    }
    .groceryBtn:hover{ background:var(--btnHover); }

    .groceryOverlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,0.55);
      opacity:0;
      pointer-events:none;
      transition:opacity 180ms ease;
      z-index: 9998;
    }
    .groceryOverlay.open{
      opacity:1;
      pointer-events:auto;
    }

    .groceryPanel{
      position:fixed;
      top:0;
      right:0;
      height:100vh;
      width:min(520px, 92vw);
      background:var(--headerBg);
      border-left:1px solid var(--border2);
      box-shadow: var(--shadow);
      backdrop-filter: blur(var(--glassBlur));
      transform: translateX(100%);
      transition: transform 220ms ease;
      z-index: 9999;
      display:flex;
      flex-direction:column;
    }
    .groceryPanel.open{ transform: translateX(0); }

    .groceryHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:12px;
      border-bottom:1px solid var(--border2);
    }
    .groceryTitle{
      font-weight:900;
      font-size:15px;
    }
    .groceryClose{
      background:var(--btn);
      color:var(--text);
      border:1px solid var(--border2);
      border-radius:12px;
      padding:10px 12px;
      cursor:pointer;
      box-shadow: var(--neuOutShadowSoft);
      min-width:44px;
      min-height:44px;
    }
    .groceryClose:hover{ background:var(--btnHover); }

    .groceryBody{
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      overflow:auto;
    }

    .groceryForm{
      display:grid;
      grid-template-columns: 1fr 120px 96px;
      gap:8px;
      align-items:center;
    }
    .groceryForm input,
    .groceryForm select{
      background:var(--inputBg);
      color:var(--text);
      border:1px solid var(--inputBorder);
      border-radius:12px;
      padding:10px 12px;
      font-size:14px;
      min-height:44px;
    }
    .groceryForm button{
      background:var(--btnActive);
      color:#000;
      border:none;
      border-radius:12px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:900;
      min-height:44px;
    }

    .groceryList{
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .groceryRow{
      background:var(--panel2);
      border:1px solid var(--border2);
      border-radius:12px;
      padding:10px;
      display:flex;
      align-items:center;
      gap:10px;
      box-shadow: var(--neuOutShadowSoft);
    }
    .groceryMeta{ flex:1; min-width:0; }
    .groceryItem{
      font-size:14px;
      font-weight:800;
      line-height:1.2;
      word-break:break-word;
    }
    .grocerySub{
      margin-top:4px;
      font-size:12px;
      color:var(--muted2);
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .groceryTag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid var(--border2);
      background: rgba(255,255,255,0.06);
      font-weight:900;
      font-size:11px;
      color:var(--text);
    }
    .groceryQty{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid var(--border2);
      background: rgba(0,0,0,0.18);
      font-weight:900;
      font-size:11px;
      color:var(--text);
    }

    .groceryRow .remove{
      background: transparent;
      border: 1px solid var(--border2);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 12px;
      cursor: pointer;
      min-width:44px;
      min-height:44px;
    }
    .groceryRow .remove:hover{ background: rgba(255,255,255,0.06); }

    .groceryActions{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:flex-end;
    }
    .groceryReset{
      background: var(--danger);
      color:#fff;
      border:none;
      border-radius:12px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:900;
      min-height:44px;
    }

    /* =========================
       MEMBER AVATARS
       - uploaded in Admin
       - displayed in each member column header on day pages
    ========================= */

    .memberHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:8px;
    }
    .memberHeader h2{ margin:0; }

    .avatarCircle{
      width:40px;
      height:40px;
      border-radius:999px;
      overflow:hidden;
      border:1px solid var(--border2);
      background: rgba(0,0,0,0.20);
      box-shadow: var(--shadow);
      flex:0 0 auto;
    }
    .avatarCircle img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .avatarFallback{
      width:40px;
      height:40px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:900;
      font-size:12px;
      letter-spacing:0.5px;
      border:1px solid var(--border2);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      box-shadow: var(--shadow);
      flex:0 0 auto;
    }

    .adminAvatarRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius: var(--radius);
      background: var(--panel2);
      box-shadow: var(--shadow);
      margin-top:10px;
    }
    .adminAvatarLeft{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 180px;
    }
    .adminAvatarName{
      font-weight:900;
    }
    .adminAvatarRight{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .fileInput{
      max-width: 260px;
    }
    .ghostBtn{
      background: transparent;
      border: 1px solid var(--border2);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 12px;
      cursor: pointer;
      min-height:44px;
    }
    .ghostBtn:hover{ background: rgba(255,255,255,0.06); }

    @media (max-width: 520px){
      .groceryForm{ grid-template-columns: 1fr; }
    }

    /* responsive */
    @media (max-width: 980px){
      .dashGrid{ grid-template-columns:1fr; }
      .columns{ grid-template-columns:1fr 1fr; }
      .yesterdayGrid{ grid-template-columns:1fr 1fr; }
      .weeklyGrid{ grid-template-columns:1fr; }
      .listGrid{ grid-template-columns:1fr; }
    }
  </style>
</head>

<body>
<header id="topNav"></header>

<main id="app"></main>
<script>
// If the module script fails to parse/load, at least show *something* instead of a blank page.
(function(){
  function showBootFailure(){
    var app = document.getElementById('app');
    if (!app) return;
    if (app.innerHTML && app.innerHTML.trim()) return;
    app.innerHTML = '<div style="padding:14px;max-width:920px;margin:14px auto;border-radius:14px;border:1px solid rgba(255,255,255,.16);background:rgba(0,0,0,.35);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;">'
      + '<div style="font-weight:900;font-size:16px;margin-bottom:6px;">Blank page blocker</div>'
      + '<div style="font-size:13px;opacity:.9;line-height:1.35;">The app script did not run (usually a JavaScript syntax error or a module import failing). Open DevTools → Console to see the exact error and line number.</div>'
      + '</div>';
  }
  window.addEventListener('error', function(){ setTimeout(showBootFailure, 0); });
  window.addEventListener('unhandledrejection', function(){ setTimeout(showBootFailure, 0); });
  document.addEventListener('DOMContentLoaded', function(){ setTimeout(showBootFailure, 250); });
})();
</script>

<script>
// --- Boot diagnostics: prevent silent blank page ---
console.log("Chore Board script started");
const __appEl = document.getElementById('app');
if (__appEl && !__appEl.innerHTML.trim()) {
  __appEl.innerHTML = '<div style="padding:14px;max-width:820px;margin:0 auto;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;color:#f5f5f5;opacity:.9;">Loading…</div>';
}
function __showFatal(label, err){
  try{
    const e = err && (err.error || err.reason || err);
    const msg = (e && (e.message || String(e))) || String(err);
    const stack = (e && e.stack) ? e.stack : '';
    const html = `
      <div style="padding:14px;max-width:920px;margin:14px auto;border-radius:14px;border:1px solid rgba(255,255,255,.16);background:rgba(0,0,0,.35);">
        <div style="font-weight:900;font-size:16px;margin-bottom:6px;">App crashed (${label})</div>
        <div style="font-size:13px;opacity:.9;line-height:1.35;">${String(msg).replace(/</g,'&lt;')}</div>
        ${stack ? `<pre style="margin-top:10px;white-space:pre-wrap;font-size:12px;opacity:.85;">${String(stack).replace(/</g,'&lt;')}</pre>` : ''}
        <div style="margin-top:10px;font-size:12px;opacity:.85;">Open DevTools Console for details.</div>
      </div>`;
    const a = document.getElementById('app');
    if (a) a.innerHTML = html;
  } catch(_){}
}
window.addEventListener('error', (ev) => __showFatal('error', ev));
window.addEventListener('unhandledrejection', (ev) => __showFatal('promise', ev));
// --- End diagnostics ---

// ------------------------------
// Storage helpers (local-only)
// NOTE: must be defined before any theme/state code that calls jget/jset.
// ------------------------------
function jget(key, fallback){
  try {
    const raw = localStorage.getItem(key);
    if (raw == null) return fallback;
    return JSON.parse(raw);
  } catch(_) {
    return fallback;
  }
}
function jset(key, value){
  try { localStorage.setItem(key, JSON.stringify(value)); } catch(_) {}
}

/* =========================
   SYNC (TEMP DISABLED)
   - Firebase/Auth/Firestore removed for now to restore a stable offline/local-only app.
   - When you're ready to re-enable sync, we can re-add Firebase behind a feature flag.
========================= */

/* =========================
   THEME SYSTEM (Admin)
   - 5 preconfigured themes
   - each theme has Dark + Light mode
   - applies across the entire app via CSS variables
========================= */

const THEME_MEMBER_COLORS = {
  neonGlass: {
    Dad:  "#22f0b6", // neon mint
    Mom:  "#ff4fd8", // neon magenta
    Ethan:"#5aa7ff", // neon blue
    Celo: "#ffd166"  // neon amber
  },
  auroraNight: {
    Dad:  "#7df7c6", // aurora mint
    Mom:  "#b388ff", // soft violet
    Ethan:"#6aa7ff", // arctic blue
    Celo: "#ffd54f"  // warm aurora gold
  },
  sunsetHeat: {
    Dad:  "#ff8f00", // sunset orange
    Mom:  "#ff4081", // hot pink
    Ethan:"#7c4dff", // deep purple accent
    Celo: "#ffca28"  // golden sun
  },
  grapeSoda: {
    Dad:  "#7e57c2", // grape purple
    Mom:  "#ec407a", // berry pink
    Ethan:"#42a5f5", // soda blue
    Celo: "#ab47bc"  // violet
  },

  // Premium pack (radically different)
  midnightVelvet: {
    Dad:  "#25f0b8", // neon mint
    Mom:  "#ff5cd6", // neon pink
    Ethan:"#6bb3ff", // cool blue
    Celo: "#ffd36b"  // warm gold
  },
  carbonFiber: {
    Dad:  "#2af5c0", // teal
    Mom:  "#ff4f86", // hot rose
    Ethan:"#4ea1ff", // electric blue
    Celo: "#ffcf4a"  // amber
  },
  royalGold: {
    Dad:  "#2fe2b8", // emerald-mint
    Mom:  "#ff6ab1", // pink
    Ethan:"#6aa7ff", // blue
    Celo: "#d9b45a"  // gold
  },
  frostGlass: {
    Dad:  "#38f2d0", // aqua
    Mom:  "#b38cff", // violet
    Ethan:"#66b5ff", // sky blue
    Celo: "#ffe08a"  // soft gold
  },
  // Insert additional themes before paperClean:
  noirVelvet: {
    Dad: "#ff3c8c",
    Mom: "#ffcc66",
    Ethan: "#6a5cff",
    Celo: "#38f2d0"
  },
  blueprintGrid: {
    Dad: "#5ab4ff",
    Mom: "#35e6c5",
    Ethan: "#ff5a7a",
    Celo: "#ffd166"
  },
  warmClay: {
    Dad: "#ff7f50",
    Mom: "#ffb86b",
    Ethan: "#6aa7ff",
    Celo: "#c07cff"
  },
  retroTerminal: {
    Dad: "#00ff82",
    Mom: "#a7ff4f",
    Ethan: "#5ab4ff",
    Celo: "#ff4fe0"
  },
  comicPop: {
    Dad: "#ffe600",
    Mom: "#ff5a1f",
    Ethan: "#00beff",
    Celo: "#b6ff2e"
  },
  paperClean: {
    // This theme allows editing. These are the starting defaults.
    Dad:  "#4caf50",
    Mom:  "#ffb300",
    Ethan:"#42a5f5",
    Celo: "#ab47bc"
  }
};

// --- DEBUG STAGE MARKER ---
// If you can see this message in the UI, the script successfully executed up to this point.
if (__appEl) {
  __appEl.insertAdjacentHTML('beforeend',
    '<div style="padding:14px;max-width:920px;margin:14px auto;border-radius:14px;border:1px solid rgba(255,255,255,.16);background:rgba(0,0,0,.35);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;">'
    + '<div style="font-weight:900;font-size:16px;margin-bottom:6px;">Debug: Stage A reached</div>'
    + '<div style="font-size:13px;opacity:.9;line-height:1.35;">JavaScript executed through THEME_MEMBER_COLORS and is about to define THEMES.</div>'
    + '</div>');
}

</script>

<script>
const THEMES = {
  neonGlass: {
    name: "Neon Glass",
    dark: {
      "--bg": "radial-gradient(1200px 800px at 20% 10%, rgba(0,255,240,0.10), transparent 55%), radial-gradient(900px 700px at 80% 25%, rgba(255,0,200,0.10), transparent 55%), linear-gradient(180deg, #0b0f12 0%, #07090b 100%)",
      "--headerBg": "rgba(12,14,18,0.88)",
      "--panel": "rgba(255,255,255,0.06)",
      "--panel2": "rgba(255,255,255,0.08)",
      "--panel3": "rgba(0,0,0,0.28)",
      "--border": "rgba(255,255,255,0.10)",
      "--border2": "rgba(255,255,255,0.12)",
      "--text": "#f5f5f5",
      "--muted": "rgba(245,245,245,0.75)",
      "--muted2": "rgba(245,245,245,0.6)",
      "--btn": "rgba(255,255,255,0.10)",
      "--btnHover": "rgba(255,255,255,0.14)",
      "--btnActive": "#22f0b6",
      "--danger": "#c62828",
      "--inputBg": "rgba(0,0,0,0.30)",
      "--inputBorder": "rgba(255,255,255,0.14)",
      "--ringTrack": "rgba(255,255,255,0.22)",
      "--shadow": "0 14px 28px rgba(0,0,0,0.45)",
      "--glassBlur": "14px",
      "--radius": "12px"
    },
    light: {
      "--bg": "radial-gradient(1100px 800px at 25% 10%, rgba(0,180,255,0.18), transparent 55%), radial-gradient(900px 700px at 75% 25%, rgba(255,60,210,0.16), transparent 55%), linear-gradient(180deg, #f8fbff 0%, #eef2f7 100%)",
      "--headerBg": "rgba(255,255,255,0.80)",
      "--panel": "rgba(255,255,255,0.70)",
      "--panel2": "rgba(255,255,255,0.78)",
      "--panel3": "rgba(255,255,255,0.62)",
      "--border": "rgba(10,20,30,0.10)",
      "--border2": "rgba(10,20,30,0.12)",
      "--text": "#0e1114",
      "--muted": "rgba(14,17,20,0.70)",
      "--muted2": "rgba(14,17,20,0.55)",
      "--btn": "rgba(10,20,30,0.08)",
      "--btnHover": "rgba(10,20,30,0.12)",
      "--btnActive": "#22bfa0",
      "--danger": "#c62828",
      "--inputBg": "rgba(255,255,255,0.78)",
      "--inputBorder": "rgba(10,20,30,0.14)",
      "--ringTrack": "rgba(10,20,30,0.18)",
      "--shadow": "0 14px 28px rgba(20,30,40,0.18)",
      "--glassBlur": "14px",
      "--radius": "12px"
    }
  },

  paperClean: {
    name: "Paper Clean",
    dark: {
      "--bg": "linear-gradient(180deg, #121212 0%, #0b0b0b 100%)",
      "--headerBg": "rgba(20,20,20,0.92)",
      "--panel": "#171717",
      "--panel2": "#1f1f1f",
      "--panel3": "#121212",
      "--border": "#2a2a2a",
      "--border2": "#222",
      "--text": "#f5f5f5",
      "--muted": "rgba(245,245,245,0.75)",
      "--muted2": "rgba(245,245,245,0.6)",
      "--btn": "#2a2a2a",
      "--btnHover": "#343434",
      "--btnActive": "#4caf50",
      "--danger": "#c62828",
      "--inputBg": "#111",
      "--inputBorder": "#333",
      "--ringTrack": "rgba(255,255,255,0.25)",
      "--shadow": "0 12px 22px rgba(0,0,0,0.45)",
      "--glassBlur": "0px",
      "--radius": "12px"
    },
    light: {
      "--bg": "linear-gradient(180deg, #ffffff 0%, #f2f4f7 100%)",
      "--headerBg": "rgba(255,255,255,0.90)",
      "--panel": "#ffffff",
      "--panel2": "#ffffff",
      "--panel3": "#f6f7f9",
      "--border": "rgba(0,0,0,0.10)",
      "--border2": "rgba(0,0,0,0.12)",
      "--text": "#111",
      "--muted": "rgba(0,0,0,0.70)",
      "--muted2": "rgba(0,0,0,0.55)",
      "--btn": "rgba(0,0,0,0.06)",
      "--btnHover": "rgba(0,0,0,0.10)",
      "--btnActive": "#4caf50",
      "--danger": "#c62828",
      "--inputBg": "#ffffff",
      "--inputBorder": "rgba(0,0,0,0.18)",
      "--ringTrack": "rgba(0,0,0,0.16)",
      "--shadow": "0 12px 22px rgba(0,0,0,0.10)",
      "--glassBlur": "0px",
      "--radius": "12px"
    }
  }
};

// --- DEBUG STAGE MARKER ---
// If you can see this message, THEMES parsed successfully.
if (__appEl) {
  __appEl.insertAdjacentHTML('beforeend',
    '<div style="padding:14px;max-width:920px;margin:14px auto;border-radius:14px;border:1px solid rgba(255,255,255,.16);background:rgba(0,0,0,.35);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;">'
    + '<div style="font-weight:900;font-size:16px;margin-bottom:6px;">Debug: Stage B reached</div>'
    + '<div style="font-size:13px;opacity:.9;line-height:1.35;">THEMES is now minimal (2 themes). If the app still fails later, it is not the theme blob.</div>'
    + '</div>');
}

function loadThemeState(){
  const s = jget("themeState", { themeId: "neonGlass", mode: "dark" });
  if (!s || typeof s !== "object") return { themeId: "neonGlass", mode: "dark" };
  if (!THEMES[s.themeId]) s.themeId = "neonGlass";
  if (s.mode !== "dark" && s.mode !== "light") s.mode = "dark";
  return s;
}

function saveThemeState(s){ jset("themeState", s); }

function applyTheme(themeId, mode){
  const t = THEMES[themeId];
  if (!t) return;
  const vars = (mode === "light") ? t.light : t.dark;

  Object.keys(vars).forEach(k => {
    document.documentElement.style.setProperty(k, vars[k]);
  });

  // match browser chrome on mobile
  const themeColor = (mode === "light") ? "#ffffff" : "#111111";
  const meta = document.querySelector('meta[name="theme-color"]');
  if (meta) meta.setAttribute("content", themeColor);

  saveThemeState({ themeId, mode });

  // Lock member colors to the selected theme (except Paper Clean)
  if (themeId !== "paperClean") {
    const preset = THEME_MEMBER_COLORS[themeId];
    if (preset) {
      saveMemberColors({ ...preset });
    }
  } else {
    // Ensure member colors exist when returning to Paper Clean
    const current = loadMemberColors();
    PEOPLE.forEach(p => { if (!current[p]) current[p] = THEME_MEMBER_COLORS.paperClean[p] || "#ffffff"; });
    saveMemberColors(current);
  }
}

function themeLabel(themeId){
  return THEMES[themeId] ? THEMES[themeId].name : themeId;
}

</script>

<script>
// --- DEBUG STAGE MARKER ---
// If you can see this message, everything through theme helpers parsed & executed.
if (typeof __appEl !== 'undefined' && __appEl) {
  __appEl.insertAdjacentHTML('beforeend', '<div style="margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.16);background:rgba(0,0,0,.22);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;max-width:920px;margin-left:auto;margin-right:auto;">'
    + '<div style="font-weight:900;font-size:16px;margin-bottom:6px;">Debug: Stage C reached</div>'
    + '<div style="font-size:13px;opacity:.9;line-height:1.35;">Now parsing the Routes/Constants/Data section (split into its own script tag).</div>'
    + '</div>');
}

console.log('Debug: DATA script tag started');
try {

/* =========================
   ROUTES + CONSTANTS
========================= */

window.DAYS = ["lunes","martes","miercoles","jueves","viernes","sabado","domingo"];
window.PEOPLE = ["Dad","Mom","Ethan","Celo"];
const DAYS = window.DAYS;
const PEOPLE = window.PEOPLE;

function todayKey(){
  const map = ["domingo","lunes","martes","miercoles","jueves","viernes","sabado"];
  return map[new Date().getDay()];
}

function prevDayKey(dayKey){
  const idx = DAYS.indexOf(dayKey);
  if (idx === -1) return "domingo";
  return DAYS[(idx - 1 + DAYS.length) % DAYS.length];
}

function nextDayKey(dayKey){
  const idx = DAYS.indexOf(dayKey);
  if (idx === -1) return "lunes";
  return DAYS[(idx + 1) % DAYS.length];
}

function goToDayKey(dayKey){
  location.hash = "#/" + dayKey;
}

function pad2(n){ return String(n).padStart(2,"0"); }

// Returns a Date for the given dayKey in the CURRENT week (Monday->Sunday).
// Week is anchored to the user's local time.
function dateForDayKey(dayKey){
  const idx = DAYS.indexOf(dayKey);
  const now = new Date();
  const dow = now.getDay(); // 0=Sun..6=Sat

  // Start of week = Monday
  const daysSinceMonday = (dow + 6) % 7; // Mon=0, Tue=1, ... Sun=6
  const monday = new Date(now);
  monday.setHours(0,0,0,0);
  monday.setDate(monday.getDate() - daysSinceMonday);

  const d = new Date(monday);
  d.setDate(monday.getDate() + (idx >= 0 ? idx : 0));
  return d;
}

function formatMMDDYYYY(d){
  const mm = pad2(d.getMonth() + 1);
  const dd = pad2(d.getDate());
  const yyyy = d.getFullYear();
  return `${mm}-${dd}-${yyyy}`;
}

  console.log('Debug: Routes + Constants reached end');
} catch (e) {
  console.error('Debug: Routes + Constants crashed', e);
  if (typeof __showFatal === 'function') __showFatal('routes/constants', e);
}

</script>

<script>
// --- DEBUG STAGE MARKER ---
// If you can see this message, ROUTES + CONSTANTS parsed successfully and we're entering DATA.
if (typeof document !== 'undefined') {
  const el = document.getElementById('app');
  if (el) {
    el.insertAdjacentHTML('beforeend', '<div style="margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.16);background:rgba(0,0,0,.22);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;max-width:920px;margin-left:auto;margin-right:auto;">'
      + '<div style="font-weight:900;font-size:16px;margin-bottom:6px;">Debug: Stage D reached</div>'
      + '<div style="font-size:13px;opacity:.9;line-height:1.35;">Now parsing the DATA section (daily schedule, helpers, weekly chores).</div>'
      + '</div>');
  }
}

</script>

<script>
/* =========================
   DATA (still placeholders)
   - We'll replace DAILY_CHORES & WEEKLY_CHORES with your real lists later.
   - Bi-weekly/monthly/maintenance lists stay mostly empty until Phase 5-7.
========================= */
try {
// Ensure DAYS/PEOPLE exist in this script scope even if the Routes/Constants section is wrapped in a try/catch.
const DAYS = (typeof window !== 'undefined' && Array.isArray(window.DAYS)) ? window.DAYS : ["lunes","martes","miercoles","jueves","viernes","sabado","domingo"];
const PEOPLE = (typeof window !== 'undefined' && Array.isArray(window.PEOPLE)) ? window.PEOPLE : ["Dad","Mom","Ethan","Celo"];

// Daily chores are scheduled per day (lunes → domingo).
// Tasks are shared objects so 2-person chores have ONE completion state.
// `primary` is who is accountable (used for Verification mapping).
function makeTask(dayKey, slug, text, assignees, primary){
  return {
    id: `${dayKey}::${slug}`,
    text,
    assignees,      // array of PEOPLE involved (shows in both columns)
    primary         // accountable person (used for Verification)
  };
}

const DAILY_SCHEDULE = {
  lunes: [
    // Pairing change: Dad+Celo, Mom+Ethan
    makeTask("lunes", "vacuum", "Vacuum", ["Dad","Celo"], "Celo"),
    makeTask("lunes", "trash", "Take out trash", ["Dad","Celo"], "Celo"),
    makeTask("lunes", "counters", "Wipe kitchen counters", ["Dad"], "Dad"),
    makeTask("lunes", "brushHarvey", "Brush Harvey", ["Dad"], "Dad"),

    makeTask("lunes", "dishes", "Wash dishes", ["Mom","Ethan"], "Ethan"),
    makeTask("lunes", "mop", "Mop", ["Mom"], "Mom"),
    makeTask("lunes", "dining", "Wipe dining table", ["Mom"], "Mom"),
    makeTask("lunes", "walk", "Walk with Celo", ["Mom"], "Mom"),

    makeTask("lunes", "dust", "Dust", ["Ethan"], "Ethan"),
    makeTask("lunes", "dogPoop", "Dog poop", ["Ethan"], "Ethan"),

    makeTask("lunes", "feedDogs", "Feed dogs", ["Celo"], "Celo"),
    makeTask("lunes", "cabinets", "Cabinets", ["Celo"], "Celo"),
    makeTask("lunes", "read", "Read for 20 min", ["Celo"], "Celo"),
    // Celo-only weekday chores (Mon–Fri)
    makeTask("lunes", "prepBackpack", "Reminder: Prep backpack for tomorrow", ["Celo"], "Celo"),
    makeTask("lunes", "appleWatch", "Reminder: Where's your Apple Watch?", ["Celo"], "Celo")
  ],

  martes: [
    makeTask("martes", "vacuum", "Vacuum", ["Dad","Celo"], "Celo"),
    makeTask("martes", "trash", "Take out trash", ["Dad","Celo"], "Celo"),
    makeTask("martes", "dust", "Dust", ["Dad"], "Dad"),
    makeTask("martes", "cabinets", "Cabinets", ["Dad"], "Dad"),
    makeTask("martes", "walk", "Walk with Celo", ["Dad"], "Dad"),

    makeTask("martes", "dishes", "Wash dishes", ["Mom","Ethan"], "Ethan"),
    makeTask("martes", "counters", "Wipe kitchen counters", ["Mom"], "Mom"),
    makeTask("martes", "feedDogs", "Feed dogs", ["Mom"], "Mom"),

    makeTask("martes", "mop", "Mop", ["Ethan"], "Ethan"),
    makeTask("martes", "dining", "Wipe dining table", ["Ethan"], "Ethan"),

    makeTask("martes", "dogPoop", "Dog poop", ["Celo"], "Celo"),
    makeTask("martes", "read", "Read for 20 min", ["Celo"], "Celo"),
    makeTask("martes", "prepBackpack", "Reminder: Prep backpack for tomorrow", ["Celo"], "Celo"),
    makeTask("martes", "appleWatch", "Reminder: Where's your Apple Watch?", ["Celo"], "Celo")
  ],

  miercoles: [
    makeTask("miercoles", "vacuum", "Vacuum", ["Dad","Celo"], "Celo"),
    makeTask("miercoles", "trash", "Take out trash", ["Dad","Celo"], "Celo"),
    makeTask("miercoles", "dining", "Wipe dining table", ["Dad"], "Dad"),
    makeTask("miercoles", "dogPoop", "Dog poop", ["Dad"], "Dad"),
    makeTask("miercoles", "brushHarvey", "Brush Harvey", ["Dad"], "Dad"),

    makeTask("miercoles", "dishes", "Wash dishes", ["Mom","Ethan"], "Ethan"),
    makeTask("miercoles", "dust", "Dust", ["Mom"], "Mom"),
    makeTask("miercoles", "cabinets", "Cabinets", ["Mom"], "Mom"),
    makeTask("miercoles", "walk", "Walk with Celo", ["Mom"], "Mom"),

    makeTask("miercoles", "counters", "Wipe kitchen counters", ["Ethan"], "Ethan"),
    makeTask("miercoles", "feedDogs", "Feed dogs", ["Ethan"], "Ethan"),

    makeTask("miercoles", "mop", "Mop", ["Celo"], "Celo"),
    makeTask("miercoles", "read", "Read for 20 min", ["Celo"], "Celo"),
    makeTask("miercoles", "prepBackpack", "Reminder: Prep backpack for tomorrow", ["Celo"], "Celo"),
    makeTask("miercoles", "appleWatch", "Reminder: Where's your Apple Watch?", ["Celo"], "Celo")
  ],

  jueves: [
    makeTask("jueves", "vacuum", "Vacuum", ["Dad","Celo"], "Celo"),
    makeTask("jueves", "trash", "Take out trash", ["Dad","Celo"], "Celo"),
    makeTask("jueves", "mop", "Mop", ["Dad"], "Dad"),
    makeTask("jueves", "walk", "Walk with Celo", ["Dad"], "Dad"),

    makeTask("jueves", "dining", "Wipe dining table", ["Mom"], "Mom"),
    makeTask("jueves", "dogPoop", "Dog poop", ["Mom"], "Mom"),

    makeTask("jueves", "dishes", "Wash dishes", ["Mom","Ethan"], "Ethan"),
    makeTask("jueves", "cabinets", "Cabinets", ["Ethan"], "Ethan"),
    makeTask("jueves", "feedDogs", "Feed dogs", ["Ethan"], "Ethan"),

    makeTask("jueves", "dust", "Dust", ["Celo"], "Celo"),
    makeTask("jueves", "counters", "Wipe kitchen counters", ["Celo"], "Celo"),
    makeTask("jueves", "read", "Read for 20 min", ["Celo"], "Celo"),
    makeTask("jueves", "prepBackpack", "Reminder: Prep backpack for tomorrow", ["Celo"], "Celo"),
    makeTask("jueves", "appleWatch", "Reminder: Where's your Apple Watch?", ["Celo"], "Celo")
  ],

  viernes: [
    makeTask("viernes", "vacuum", "Vacuum", ["Dad","Celo"], "Celo"),
    makeTask("viernes", "trash", "Take out trash", ["Dad","Celo"], "Celo"),
    makeTask("viernes", "counters", "Wipe kitchen counters", ["Dad"], "Dad"),
    makeTask("viernes", "feedDogs", "Feed dogs", ["Dad"], "Dad"),
    makeTask("viernes", "brushHarvey", "Brush Harvey", ["Dad"], "Dad"),

    makeTask("viernes", "dishes", "Wash dishes", ["Mom","Ethan"], "Ethan"),
    makeTask("viernes", "dining", "Wipe dining table", ["Mom"], "Mom"),
    makeTask("viernes", "cabinets", "Cabinets", ["Mom"], "Mom"),
    makeTask("viernes", "walk", "Walk with Celo", ["Mom"], "Mom"),

    makeTask("viernes", "dust", "Dust", ["Ethan"], "Ethan"),
    makeTask("viernes", "dogPoop", "Dog poop", ["Ethan"], "Ethan"),

    makeTask("viernes", "mop", "Mop", ["Celo"], "Celo"),
    makeTask("viernes", "read", "Read for 20 min", ["Celo"], "Celo"),
    makeTask("viernes", "prepBackpack", "Reminder: Prep backpack for tomorrow", ["Celo"], "Celo"),
    makeTask("viernes", "appleWatch", "Reminder: Where's your Apple Watch?", ["Celo"], "Celo")
  ],

  sabado: [
    makeTask("sabado", "vacuum", "Vacuum", ["Dad","Celo"], "Celo"),
    makeTask("sabado", "trash", "Take out trash", ["Dad","Celo"], "Celo"),
    makeTask("sabado", "cabinets", "Cabinets", ["Dad"], "Dad"),
    makeTask("sabado", "dogPoop", "Dog poop", ["Dad"], "Dad"),
    makeTask("sabado", "walk", "Walk with Celo", ["Dad"], "Dad"),

    makeTask("sabado", "dishes", "Wash dishes", ["Mom","Ethan"], "Ethan"),
    makeTask("sabado", "dust", "Dust", ["Mom"], "Mom"),
    makeTask("sabado", "counters", "Wipe kitchen counters", ["Mom"], "Mom"),

    makeTask("sabado", "dining", "Wipe dining table", ["Ethan"], "Ethan"),
    makeTask("sabado", "mop", "Mop", ["Ethan"], "Ethan"),

    makeTask("sabado", "feedDogs", "Feed dogs", ["Celo"], "Celo"),
    makeTask("sabado", "read", "Read for 20 min", ["Celo"], "Celo")
  ],

  domingo: [
    makeTask("domingo", "vacuum", "Vacuum", ["Dad","Celo"], "Celo"),
    makeTask("domingo", "trash", "Take out trash", ["Dad","Celo"], "Celo"),
    makeTask("domingo", "mop", "Mop", ["Dad"], "Dad"),

    makeTask("domingo", "dishes", "Wash dishes", ["Mom","Ethan"], "Ethan"),
    makeTask("domingo", "dust", "Dust", ["Mom"], "Mom"),
    makeTask("domingo", "cabinets", "Cabinets", ["Mom"], "Mom"),
    makeTask("domingo", "walk", "Walk with Celo", ["Mom"], "Mom"),

    makeTask("domingo", "dining", "Wipe dining table", ["Ethan"], "Ethan"),
    makeTask("domingo", "dogPoop", "Dog poop", ["Ethan"], "Ethan"),

    makeTask("domingo", "feedDogs", "Feed dogs", ["Celo"], "Celo"),
    makeTask("domingo", "counters", "Wipe kitchen counters", ["Celo"], "Celo"),
    makeTask("domingo", "read", "Read for 20 min", ["Celo"], "Celo")
  ]
};

// -------------------------
// Phase 8.3 + 8.4 helpers
// -------------------------
const PARENTS = ["Dad", "Mom"];
const KIDS = ["Ethan", "Celo"];

function isParent(p){ return PARENTS.includes(p); }
function isKid(p){ return KIDS.includes(p); }

// =========================
// DAILY TASKS (STABLE)
// =========================
// IMPORTANT: Keep this logic boring and predictable.
// We can reintroduce “fair shuffle/rotation” once the app is loading consistently again.

// Phase 8.4: Walk alternates every other day. Mom starts on lunes.
function walkAssigneeForDay(dayKey){
  const idx = DAYS.indexOf(dayKey);
  // lunes (idx 0) => Mom, martes (1) => Dad, etc.
  return (idx % 2 === 0) ? "Mom" : "Dad";
}

function buildWalkTask(dayKey){
  const who = walkAssigneeForDay(dayKey);
  return makeTask(dayKey, "walk", "Walk with Celo", [who], who);
}

// Phase 8.3: Enforce the ONLY allowed 2-person pairings:
//   - Mom + Ethan
//   - Dad + Celo
// If schedule data ever drifts, we auto-correct deterministically.
function normalizeTwoPersonTask(task){
  if (!task || !Array.isArray(task.assignees) || task.assignees.length !== 2) return task;

  const a = task.assignees[0];
  const b = task.assignees[1];

  const isAllowed = (a === "Mom" && b === "Ethan") || (a === "Ethan" && b === "Mom") ||
                    (a === "Dad" && b === "Celo")  || (a === "Celo"  && b === "Dad");
  if (isAllowed) return task;

  // If this is a 2-person task, force it into one of the two allowed pairings.
  // Preference: if Mom/Ethan is present, use that pair; otherwise Dad/Celo.
  const hasMom = task.assignees.includes("Mom");
  const hasEthan = task.assignees.includes("Ethan");
  const fixed = (hasMom || hasEthan) ? ["Mom","Ethan"] : ["Dad","Celo"];

  // Keep primary consistent with the kid on the pair.
  const primary = (fixed[1] === "Ethan") ? "Ethan" : "Celo";
  return { ...task, assignees: fixed, primary };
}

function getTasksForDay(dayKey){
  // Pull from schedule
  const base = (DAILY_SCHEDULE[dayKey] || []).slice();

  // Ensure there is exactly ONE walk task, controlled by alternation logic.
  const withoutWalk = base.filter(t => {
    const id = (t && t.id) ? t.id : "";
    return !id.endsWith("::walk");
  });
  withoutWalk.push(buildWalkTask(dayKey));

  // Apply pairing guardrails (only affects 2-person chores).
  return withoutWalk.map(t => normalizeTwoPersonTask(t));
}
const WEEKLY_CHORES = [
  "Sweep",
  "Mop",
  "Vacuum",
  "Trash",
  "Wipe kitchen counters",
  "Wipe dining table"
];

  console.log('Debug: Stage E reached (DATA parsed & executed)');
  (function(){
    try {
      const html = '<div style="margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.16);background:rgba(0,0,0,.22);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;max-width:920px;margin-left:auto;margin-right:auto;">'
        + '<div style="font-weight:900;font-size:16px;margin-bottom:6px;">Debug: Stage E reached</div>'
        + '<div style="font-size:13px;opacity:.9;line-height:1.35;">DATA executed successfully. Next failure (if any) is in UI/render/state code after DATA.</div>'
        + '</div>';
      const el = document.getElementById('app');
      if (el) el.insertAdjacentHTML('beforeend', html);
      else document.body.insertAdjacentHTML('afterbegin', html);
    } catch(_) {}
  })();

} catch (e) {
  console.error('Debug: DATA crashed', e);
  if (typeof __showFatal === 'function') __showFatal('data', e);
}

</script>

<script>
console.log('Debug: Recovery script tag executed');
(function(){
  try {
    const html = '<div style="margin:14px auto;max-width:920px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.16);background:rgba(0,0,0,.22);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;">'
      + '<div style="font-weight:900;font-size:16px;margin-bottom:6px;">Recovery Mode enabled</div>'
      + '<div style="font-size:13px;opacity:.9;line-height:1.35;">Minimal day-view renderer (local-only). Debug markers can be removed once the full UI is restored.</div>'
      + '</div>';
    document.body.insertAdjacentHTML('afterbegin', html);
  } catch(_) {}
})();


// ------------------------------
// Recovery constants/helpers
// (do NOT rely on the earlier try/catch block scope)
// ------------------------------
const __DAYS_RECOVERY = ["lunes","martes","miercoles","jueves","viernes","sabado","domingo"];
const __PEOPLE_RECOVERY = ["Dad","Mom","Ethan","Celo"];

function __todayKey(){
  const map = ["domingo","lunes","martes","miercoles","jueves","viernes","sabado"];
  return map[new Date().getDay()];
}

function __pad2(n){ return String(n).padStart(2,"0"); }

function __dateForDayKey(dayKey){
  const idx = __DAYS_RECOVERY.indexOf(dayKey);
  const now = new Date();
  const dow = now.getDay(); // 0=Sun..6=Sat

  // Start of week = Monday
  const daysSinceMonday = (dow + 6) % 7; // Mon=0..Sun=6
  const monday = new Date(now);
  monday.setHours(0,0,0,0);
  monday.setDate(monday.getDate() - daysSinceMonday);

  const d = new Date(monday);
  d.setDate(monday.getDate() + (idx >= 0 ? idx : 0));
  return d;
}

function __formatMMDDYYYY(d){
  const mm = __pad2(d.getMonth() + 1);
  const dd = __pad2(d.getDate());
  const yyyy = d.getFullYear();
  return `${mm}-${dd}-${yyyy}`;
}

function __esc(s){
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

// ------------------------------
// Completion state
// ------------------------------
function __taskDoneKey(taskId){ return 'done::' + taskId; }
function __isTaskDone(taskId){ return !!jget(__taskDoneKey(taskId), false); }
function __setTaskDone(taskId, v){ jset(__taskDoneKey(taskId), !!v); }

// ------------------------------
// Minimal UI
// ------------------------------
function __renderTopNav(dayKey){
  const top = document.getElementById('topNav');
  if (!top) return;

  const btns = __DAYS_RECOVERY.map(d => {
    const active = d === dayKey ? 'active' : '';
    const label = d.charAt(0).toUpperCase() + d.slice(1);
    return `<button class="navBtn ${active}" data-day="${d}">${label}</button>`;
  }).join('');

  top.innerHTML = `
    <button class="navBtn" id="goToday">Today</button>
    ${btns}
    <div class="spacer"></div>
    <button class="navBtn" id="resetDay">Reset Day</button>
  `;

  top.querySelectorAll('button[data-day]').forEach(b => {
    b.addEventListener('click', () => {
      const dk = b.getAttribute('data-day');
      location.hash = '#/' + dk;
    });
  });

  const todayBtn = document.getElementById('goToday');
  if (todayBtn) todayBtn.addEventListener('click', () => {
    location.hash = '#/' + __todayKey();
  });

  const resetBtn = document.getElementById('resetDay');
  if (resetBtn) resetBtn.addEventListener('click', () => {
    const tasks = (typeof getTasksForDay === 'function') ? getTasksForDay(dayKey) : [];
    tasks.forEach(t => __setTaskDone(t.id, false));
    __renderDay(dayKey);
  });
}

function __renderDay(dayKey){
  const app = document.getElementById('app');
  if (!app) return;

  __renderTopNav(dayKey);

  const d = __dateForDayKey(dayKey);
  const dateStr = __formatMMDDYYYY(d);

  const tasks = (typeof getTasksForDay === 'function') ? getTasksForDay(dayKey) : [];

  // bucket tasks by person (shared chores appear in both columns)
  const buckets = {};
  __PEOPLE_RECOVERY.forEach(p => buckets[p] = []);
  tasks.forEach(t => {
    (t.assignees || []).forEach(p => {
      if (buckets[p]) buckets[p].push(t);
    });
  });

  const cols = __PEOPLE_RECOVERY.map(p => {
    const list = (buckets[p] || []).map(t => {
      const checked = __isTaskDone(t.id) ? 'checked' : '';
      const label = __esc(t.text);
      return `
        <div class="chore">
          <label class="choreLabel">
            <input type="checkbox" data-task="${__esc(t.id)}" ${checked} />
            <span>${label}</span>
          </label>
        </div>
      `;
    }).join('');

    return `
      <section class="column">
        <div class="dayHeaderBar">
          <h2 class="dayTitle">${__esc(p)}</h2>
          <div class="dayDate">${__esc(dateStr)}</div>
        </div>
        ${list || '<div class="hint">No tasks.</div>'}
      </section>
    `;
  }).join('');

  app.innerHTML = `
    <div class="panel">
      <div style="font-weight:900;font-size:16px;">Recovery Mode: Day View</div>
      <div class="hint">This is a minimal renderer to get you unstuck. Once the full UI/router code is restored, we can remove this block and the debug markers.</div>
    </div>
    <div class="columns">${cols}</div>
  `;

  // wire checkboxes
  app.querySelectorAll('input[type="checkbox"][data-task]').forEach(cb => {
    cb.addEventListener('change', () => {
      const id = cb.getAttribute('data-task');
      __setTaskDone(id, cb.checked);
    });
  });
}

function __currentRouteDayKey(){
  const h = location.hash || '';
  const m = h.match(/^#\/(.+)$/);
  const dk = m ? m[1] : '';
  return __DAYS_RECOVERY.includes(dk) ? dk : __todayKey();
}

function __bootRecovery(){
  // Apply default theme if possible (theme functions expect jget/jset)
  try {
    if (typeof loadThemeState === 'function' && typeof applyTheme === 'function') {
      const s = loadThemeState();
      applyTheme(s.themeId, s.mode);
    }
  } catch(_) {}

  __renderDay(__currentRouteDayKey());
}

window.addEventListener('hashchange', () => __renderDay(__currentRouteDayKey()));
__bootRecovery();
</script>
