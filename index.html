<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chore Board</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#111111" />
  <link rel="manifest" href="manifest.webmanifest" />

  <style>
    body {
      margin: 0;
      background: #111;
      color: #f5f5f5;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      display: flex;
      gap: 8px;
      padding: 10px;
      background: #1a1a1a;
      flex-wrap: wrap;
      align-items: center;
    }

    header button {
      background: #2a2a2a;
      color: #fff;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
    }

    header button.active {
      background: #4caf50;
      color: #000;
    }

    header .spacer {
      flex: 1;
    }

    header .reset {
      background: #c62828;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 10px;
      overflow: hidden;
      gap: 10px;
    }

    .columns {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      overflow: hidden;
      min-height: 0;
    }

    .column {
      background: #1f1f1f;
      border-radius: 8px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .column h2 {
      margin: 0 0 8px 0;
      text-align: center;
      font-size: 16px;
    }

    .chore {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
      font-size: 14px;
    }

    /* Phase 2: Yesterday Summary */
    .yesterday {
      background: #171717;
      border: 1px solid #2a2a2a;
      border-radius: 8px;
      padding: 10px;
    }

    .yesterday h3 {
      margin: 0 0 8px 0;
      font-size: 14px;
      opacity: 0.9;
      letter-spacing: 0.2px;
    }

    .yesterday .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }

    .yesterday .person {
      background: #121212;
      border: 1px solid #222;
      border-radius: 8px;
      padding: 8px;
      min-height: 48px;
    }

    .yesterday .personTitle {
      font-weight: 600;
      font-size: 13px;
      margin-bottom: 6px;
      opacity: 0.95;
      text-align: center;
    }

    .yesterday .line {
      font-size: 12.5px;
      opacity: 0.9;
      margin: 4px 0;
      line-height: 1.2;
      word-break: break-word;
    }

    .notes h3 {
      margin: 0 0 6px 0;
      font-size: 14px;
      opacity: 0.9;
    }

    .notes textarea {
      width: 100%;
      min-height: 70px;
      background: #121212;
      color: #fff;
      border: 1px solid #333;
      border-radius: 6px;
      padding: 8px;
      resize: vertical;
    }
  </style>
</head>

<body>

<header id="dayNav"></header>

<main>
  <div class="columns" id="columns"></div>

  <!-- Phase 2: Yesterday Summary (text-only) -->
  <section class="yesterday" aria-label="Yesterday Summary">
    <h3 id="yesterdayTitle">Ayer</h3>
    <div class="grid" id="yesterdayGrid"></div>
  </section>

  <div class="notes">
    <h3>Notas del día</h3>
    <textarea id="dailyNotes" placeholder="Notas para hoy..."></textarea>
  </div>
</main>

<script>
/* =========================
   DATA DEFINITIONS
========================= */

const DAYS = ["lunes","martes","miercoles","jueves","viernes","sabado","domingo"];
const PEOPLE = ["Dad","Mom","Ethan","Celo"];

/**
 * Phase 1/2: simple shared daily chore list (same each day).
 * Later, we can evolve this into DAILY_CHORES_BY_DAY if needed without breaking Phase 2.
 */
const DAILY_CHORES = {
  Dad: ["Dog poop","Trash"],
  Mom: ["Laundry","Kitchen"],
  Ethan: ["Room","Homework"],
  Celo: ["Dishes","Toys"]
};

/* =========================
   STATE HELPERS
========================= */

function todayKey() {
  const map = ["domingo","lunes","martes","miercoles","jueves","viernes","sabado"];
  return map[new Date().getDay()];
}

function loadState() {
  return JSON.parse(localStorage.getItem("dailyState") || "{}");
}

function saveState(state) {
  localStorage.setItem("dailyState", JSON.stringify(state));
}

/* =========================
   PHASE 2 HELPERS
========================= */

function prevDayKey(dayKey) {
  const idx = DAYS.indexOf(dayKey);
  if (idx === -1) return "domingo";
  return DAYS[(idx - 1 + DAYS.length) % DAYS.length];
}

function displayDayLabel(dayKey) {
  // Simple label for now. We can prettify later.
  return dayKey;
}

function getDailyChoresForDay(/*dayKey*/) {
  // For Phase 2 we use the same list for every day.
  // If you later want day-specific daily chores, we swap this implementation.
  return DAILY_CHORES;
}

/* =========================
   RENDERING
========================= */

let currentDay = location.hash.replace("#/","") || todayKey();

function renderNav() {
  const nav = document.getElementById("dayNav");
  nav.innerHTML = "";

  DAYS.forEach(day => {
    const btn = document.createElement("button");
    btn.textContent = day;
    if (day === currentDay) btn.classList.add("active");
    btn.onclick = () => {
      location.hash = "#/" + day;
    };
    nav.appendChild(btn);
  });

  const spacer = document.createElement("div");
  spacer.className = "spacer";
  nav.appendChild(spacer);

  const resetBtn = document.createElement("button");
  resetBtn.textContent = "Weekly Reset";
  resetBtn.className = "reset";
  resetBtn.onclick = weeklyReset;
  nav.appendChild(resetBtn);
}

function renderDay() {
  const columns = document.getElementById("columns");
  columns.innerHTML = "";

  const state = loadState();
  state[currentDay] = state[currentDay] || { checks:{}, notes:"" };

  const choresForToday = getDailyChoresForDay(currentDay);

  PEOPLE.forEach(person => {
    const col = document.createElement("div");
    col.className = "column";

    const h = document.createElement("h2");
    h.textContent = person;
    col.appendChild(h);

    (choresForToday[person] || []).forEach(chore => {
      const key = person + "::" + chore;
      const row = document.createElement("div");
      row.className = "chore";

      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.checked = !!state[currentDay].checks[key];
      cb.onchange = () => {
        state[currentDay].checks[key] = cb.checked;
        saveState(state);
      };

      const label = document.createElement("span");
      label.textContent = chore;

      row.appendChild(cb);
      row.appendChild(label);
      col.appendChild(row);
    });

    columns.appendChild(col);
  });

  const notes = document.getElementById("dailyNotes");
  notes.value = state[currentDay].notes || "";
  notes.oninput = () => {
    state[currentDay].notes = notes.value;
    saveState(state);
  };

  renderYesterdaySummary();
}

function renderYesterdaySummary() {
  const yesterday = prevDayKey(currentDay);
  const title = document.getElementById("yesterdayTitle");
  title.textContent = `Ayer (${displayDayLabel(yesterday)})`;

  const grid = document.getElementById("yesterdayGrid");
  grid.innerHTML = "";

  const choresYesterday = getDailyChoresForDay(yesterday);

  PEOPLE.forEach(person => {
    const card = document.createElement("div");
    card.className = "person";

    const pt = document.createElement("div");
    pt.className = "personTitle";
    pt.textContent = person;
    card.appendChild(pt);

    const list = choresYesterday[person] || [];
    if (list.length === 0) {
      const line = document.createElement("div");
      line.className = "line";
      line.textContent = "—";
      card.appendChild(line);
    } else {
      list.forEach(chore => {
        const line = document.createElement("div");
        line.className = "line";
        line.textContent = `${person} – ${chore}`;
        card.appendChild(line);
      });
    }

    grid.appendChild(card);
  });
}

/* =========================
   RESET LOGIC
========================= */

function weeklyReset() {
  if (!confirm("Reset ALL daily checkboxes and notes?")) return;
  localStorage.removeItem("dailyState");
  renderDay();
}

/* =========================
   ROUTING
========================= */

window.addEventListener("hashchange", () => {
  currentDay = location.hash.replace("#/","") || todayKey();
  renderNav();
  renderDay();
});

/* =========================
   INIT
========================= */

renderNav();
renderDay();

/* =========================
   SERVICE WORKER
========================= */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("./service-worker.js");
}
</script>

</body>
</html>
